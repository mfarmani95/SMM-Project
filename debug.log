2025-10-09 16:21:39,466 [INFO] root: Logger initialized
2025-10-09 16:21:39,466 [INFO] root: Starting SMM analysis using config: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/configs/Test.yml
2025-10-09 16:21:39,466 [INFO] smm.main: üöÄ Starting SMM pipeline using config file: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/configs/Test.yml
2025-10-09 16:21:39,472 [DEBUG] smm.main: Configuration loaded successfully:
{'data': {'sm_file': '/Users/mohammad/Downloads/surface_SM_2019-01.nc', 'prcp_file': '/Users/mohammad/Downloads/precip_2019-01.nc', 'var_sm': 'H2OSOI', 'var_prcp': 'PRECTmms', 'lat': 431, 'lon': -1}, 'parameters': {'thickness': 0.1, 'threshold_factor': 0.12, 'min_length': 3, 'max_zeros': 0, 'max_consecutive_positives': 1, 'max_gap_days': 6, 'r2_threshold': 0.8, 'dim': 'time', 'precip_length_unit': 'mm', 'precip_time_unit': 's', 'sm_timestep': 'day'}, 'output': {'save_dir': '/Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR', 'plot': False, 'save_csv': True}}
2025-10-09 16:21:39,472 [INFO] smm.main: üì• Loading soil moisture and precipitation data...
2025-10-09 16:21:39,472 [INFO] smm.dataloader: üì• Loading data from SM file: /Users/mohammad/Downloads/surface_SM_2019-01.nc and PRCP file: /Users/mohammad/Downloads/precip_2019-01.nc
2025-10-09 16:21:39,583 [DEBUG] smm.dataloader: SM dataset dims: FrozenMappingWarningOnValuesAccess({'time': 31, 'lon': 444, 'lat': 432}), PRCP dataset dims: FrozenMappingWarningOnValuesAccess({'time': 31, 'lat': 432, 'lon': 444})
2025-10-09 16:21:39,592 [INFO] smm.dataloader: üìç Extracted using indices: lat_idx=431, lon_idx=-1
2025-10-09 16:21:39,593 [DEBUG] smm.dataloader: Aligned precipitation time axis with soil moisture.
2025-10-09 16:21:39,594 [INFO] smm.dataloader: üîÑ Converting precipitation units: mm/s to day
2025-10-09 16:21:39,594 [INFO] smm.utils.unit_utils: Converting precip from [mm/s] to match SM timestep [day]
2025-10-09 16:21:39,598 [INFO] smm.utils.unit_utils: ‚úÖ Precip conversion complete. Scale factor=0.000012
2025-10-09 16:21:39,598 [INFO] smm.dataloader: ‚úÖ Precipitation converted successfully.
2025-10-09 16:21:39,598 [INFO] smm.dataloader: ‚úÖ Data loading completed. Timesteps: 31
2025-10-09 16:21:39,598 [INFO] smm.main: ‚úÖ Data loaded successfully.
2025-10-09 16:21:39,598 [DEBUG] smm.main: Soil moisture shape: (31,), Precip shape: (31,)
2025-10-09 16:21:39,605 [DEBUG] smm.main: Threshold computed: 0.000136
2025-10-09 16:21:39,606 [INFO] smm.analyzer: üßÆ SoilMoistureAnalyzer initialized
2025-10-09 16:21:39,606 [DEBUG] smm.analyzer: threshold=0.00013586997985839844, min_length=3, max_zeros=0, max_pos=1, max_gap_days=6, r2_threshold=0.8, dim=time
2025-10-09 16:21:39,606 [INFO] smm.main: üßÆ Analyzer initialized.
2025-10-09 16:21:39,606 [INFO] smm.analyzer: üîé Detecting drydowns...
2025-10-09 16:21:39,609 [INFO] smm.analyzer: ‚úÖ Found 3 drydowns (after min length filtering).
2025-10-09 16:21:39,609 [INFO] smm.analyzer: üìâ Fitting exponential decay to 3 drydowns...
2025-10-09 16:21:39,612 [DEBUG] smm.analyzer: Fit success [2018-12-30T20:00:00.000000 ‚Üí 2019-01-04T20:00:00.000000]: A=0.0010, B=0.4403, C=0.9652, R¬≤=0.969
2025-10-09 16:21:39,615 [DEBUG] smm.analyzer: Fit success [2019-01-10T20:00:00.000000 ‚Üí 2019-01-22T20:00:00.000000]: A=0.0011, B=0.1250, C=0.9653, R¬≤=0.992
2025-10-09 16:21:39,616 [WARNING] smm.analyzer: ‚ö†Ô∏è Fit failed for drydown [2019-01-26T20:00:00.000000 ‚Üí 2019-01-29T20:00:00.000000]: Initial guess is outside of provided bounds
2025-10-09 16:21:39,616 [INFO] smm.analyzer: ‚úÖ Finished fitting. 2 successful fits.
2025-10-09 16:21:39,616 [INFO] smm.analyzer: üìä 2 fits passed R¬≤ threshold (0.8).
2025-10-09 16:21:39,616 [INFO] smm.analyzer: üåßÔ∏è Detected 10 positive increments (Tau_S candidates).
2025-10-09 16:21:39,616 [INFO] smm.main: ‚úÖ Drydown detection complete: 2 events found, 3 fits.
2025-10-09 16:21:39,616 [DEBUG] smm.main: Fit sample: {'start': np.datetime64('2018-12-30T20:00:00.000000'), 'end': np.datetime64('2019-01-04T20:00:00.000000'), 'A': np.float64(0.0010039957895014845), 'TaU_L': np.float64(0.44033902107821093), 'C': np.float64(0.9651553631375575), 'r2': np.float64(0.9686249379980332)}
2025-10-09 16:21:39,616 [INFO] smm.analyzer: ‚è≥ Calculating short-term timescales (Tau_S)...
2025-10-09 16:21:39,617 [DEBUG] smm.analyzer: Tau_S for [2019-01-04T20:00:00.000000 ‚Üí 2019-01-05T20:00:00.000000] = -0.048
2025-10-09 16:21:39,618 [DEBUG] smm.analyzer: Tau_S for [2019-01-05T20:00:00.000000 ‚Üí 2019-01-06T20:00:00.000000] = -0.045
2025-10-09 16:21:39,618 [DEBUG] smm.analyzer: Tau_S for [2019-01-06T20:00:00.000000 ‚Üí 2019-01-07T20:00:00.000000] = -0.049
2025-10-09 16:21:39,619 [DEBUG] smm.analyzer: Tau_S for [2019-01-07T20:00:00.000000 ‚Üí 2019-01-08T20:00:00.000000] = -0.056
2025-10-09 16:21:39,619 [DEBUG] smm.analyzer: Tau_S for [2019-01-08T20:00:00.000000 ‚Üí 2019-01-09T20:00:00.000000] = -0.056
2025-10-09 16:21:39,620 [DEBUG] smm.analyzer: Tau_S for [2019-01-09T20:00:00.000000 ‚Üí 2019-01-10T20:00:00.000000] = -0.064
2025-10-09 16:21:39,620 [DEBUG] smm.analyzer: Tau_S for [2019-01-22T20:00:00.000000 ‚Üí 2019-01-23T20:00:00.000000] = -0.046
2025-10-09 16:21:39,621 [DEBUG] smm.analyzer: Tau_S for [2019-01-23T20:00:00.000000 ‚Üí 2019-01-24T20:00:00.000000] = -0.046
2025-10-09 16:21:39,621 [DEBUG] smm.analyzer: Tau_S for [2019-01-24T20:00:00.000000 ‚Üí 2019-01-25T20:00:00.000000] = -0.051
2025-10-09 16:21:39,622 [DEBUG] smm.analyzer: Tau_S for [2019-01-28T20:00:00.000000 ‚Üí 2019-01-29T20:00:00.000000] = -0.052
2025-10-09 16:21:39,622 [INFO] smm.analyzer: ‚úÖ Computed 10 Tau_S values.
2025-10-09 16:21:39,622 [INFO] smm.main: ‚úÖ Computed 10 short-term timescale (Tau_S) values.
2025-10-09 16:21:39,622 [DEBUG] smm.main: Ts sample: [np.float64(-0.04788709392085354), np.float64(-0.04479193283045984), np.float64(-0.04934695289315257), np.float64(-0.05617158638300501), np.float64(-0.056389308437079205)]
2025-10-09 16:21:39,622 [INFO] smm.main: üíæ Saving Ts values...
2025-10-09 16:21:39,622 [INFO] smm.utils.io_utils: Saving Ts values with metadata to output directory: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR
2025-10-09 16:21:39,622 [DEBUG] smm.utils.io_utils: Ensured output directory exists: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR
2025-10-09 16:21:39,624 [DEBUG] smm.utils.io_utils: Constructed DataFrame with 10 entries.
2025-10-09 16:21:39,626 [INFO] smm.utils.io_utils: ‚úÖ Ts values and metadata successfully saved as CSV: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR/Ts_values.csv
2025-10-09 16:21:39,633 [DEBUG] smm.utils.io_utils: CSV head preview:
                start                 end  increment        Ts
0 2019-01-04 20:00:00 2019-01-05 20:00:00   0.000354 -0.047887
1 2019-01-05 20:00:00 2019-01-06 20:00:00   0.000643 -0.044792
2 2019-01-06 20:00:00 2019-01-07 20:00:00   0.000099 -0.049347
3 2019-01-07 20:00:00 2019-01-08 20:00:00   0.000017 -0.056172
4 2019-01-08 20:00:00 2019-01-09 20:00:00   0.000014 -0.056389
2025-10-09 16:21:39,635 [INFO] smm.utils.io_utils: ‚úÖ Ts values and metadata successfully saved as JSON: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR/Ts_values.json
2025-10-09 16:21:39,635 [INFO] smm.main: ‚úÖ Ts values saved successfully.
2025-10-09 16:21:39,635 [INFO] smm.main: üíæ Saving TL fit parameters...
2025-10-09 16:21:39,635 [INFO] smm.utils.io_utils: Saving TL fit parameters to output directory: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR
2025-10-09 16:21:39,635 [DEBUG] smm.utils.io_utils: Ensured output directory exists: /Users/mohammad/Desktop/PHD/PHD/Behrangi  and Niu/ISMN/SMM_code/smm/resultsR
2025-10-09 16:21:39,635 [ERROR] smm.utils.io_utils: ‚ùå Failed to save TL fit parameters: 'TAU_L'
Traceback (most recent call last):
  File "/Users/mohammad/miniforge3/envs/smm/lib/python3.10/site-packages/smm/utils/io_utils.py", line 155, in save_tl_fits
    "b": float(f["TAU_L"]) if isinstance(f["TAU_L"], (np.floating, float)) else f["TAU_L"],
KeyError: 'TAU_L'
2025-10-09 16:21:39,635 [ERROR] smm.main: ‚ùå SMM pipeline failed: 'TAU_L'
Traceback (most recent call last):
  File "/Users/mohammad/miniforge3/envs/smm/lib/python3.10/site-packages/smm/main.py", line 86, in SMM
    save_tl_fits(fits, cfg["output"]["save_dir"])
  File "/Users/mohammad/miniforge3/envs/smm/lib/python3.10/site-packages/smm/utils/io_utils.py", line 155, in save_tl_fits
    "b": float(f["TAU_L"]) if isinstance(f["TAU_L"], (np.floating, float)) else f["TAU_L"],
KeyError: 'TAU_L'
2025-10-09 16:21:39,644 [DEBUG] matplotlib.pyplot: Loaded backend macosx version unknown.
